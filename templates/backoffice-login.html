{% extends "layout.html" %}

{% block title %}백 오피스{% endblock %}

{% block head %}
<style>
    form {
        display: flex;
        flex-direction: column;
    }
    form .custom-form-item {
        display: flex;
        flex-direction: column;
        padding: 0 24px;
        margin-bottom: 16px;
    }
    form .custom-form-item > label,
    form .custom-form-item > div,
    form .custom-form-item > input {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        padding: 0;
        color: #777777;
    } 
    form .custom-form-item > input {
        border: 1px solid #cccccc;
    }
    form .custom-form-item .invalid-feedback {
        display: none;
        width: 100%;
        font-size: .875em;
        color: var(--bs-form-invalid-color);
    }
    form .custom-form-item .is-invalid~.invalid-feedback {
        display: block;
    }
    .custom-form-item .form-control {
        padding: 10px 16px;
    }
    .custom-signup > a {
        display: block;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div>
    <h1 class="content-title">임직원 로그인</h1>
</div>
<div>
    <form class="needs-validation" id="signin" novalidate>
        <div class="custom-form-item">
            <label for="identify" class="form-label">아이디</label>
            <input type="text" class="form-control" id="identify" required>
            <div class="invalid-feedback">
                아이디를 입력해주세요.
            </div>
        </div>
        <div class="custom-form-item">
            <label for="password" class="form-label">비밀번호</label>
            <input type="password" class="form-control" id="password" required>
            <div class="invalid-feedback">
                비밀번호를 입력해주세요.
            </div>
        </div>
        <button type="submit" class="btn btn-dark-custom">로그인</button>
    </form>
    <div class="custom-signup">
        <a href="{{url_for('signup')}}" class="btn btn-dark-custom">회원가입</a>
    </div>
</div>

{% endblock %}

{% block script %}
<script>
const identifyValidation = () => {
    // 아이디 검증
    // 빈칸 확인
    const identify = document.querySelector('#identify');    
    if (!identify.value) {
        identify.classList.add('is-invalid');
        return false
    }

    // 외국인이라면 통과
    const radioKorean = document.querySelector('#radioNationality1');
    if (!radioKorean.checked) {
        return true
    }

    // 내국인이라면 한글 체크
    if (/^[ㄱ-ㅎㅏ-ㅣ가-힣]+$/.test(identify.value)) {
        return true
    }
    identify.classList.add('is-invalid');
    return false
}

const passwordValidation = () => {
    // 비밀번호 검증
    // 빈칸 확인
    const password = document.querySelector('#password');
    if (!password.value) {
        password.classList.add('is-invalid');
        return false
    }
    return true
}

(() => {
    'use strict';
    // focus시 is-invalid 삭제
    const allInput = document.querySelectorAll('.needs-validation input');
    allInput.forEach((each) => {
        each.addEventListener('focus', () => {
            each.classList.remove('is-invalid');    
        })
    })

    // Form 검증
    const customValidity = () => {
        let result = true;
        if (!identifyValidation()) {
            result = false;
        }
        if (!passwordValidation()) {
            result = false;
        }
        return result
    }

    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', event => {
        if (!customValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
    }, false);
})()

$('#signin').on('submit', function(event) {
      event.preventDefault();
      var userid = $('#identify').val();
      var userpw = $('#password').val();

      $.ajax({
          url: '/signin',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ID: userid, PW: userpw}),
          success: function(response) {
              alert("로그인 되었습니다.");
              window.location.href = 'calendar'

          },
          error: function(response) {
              alert(response.responseJSON.message);
          }
      });
  });
</script>
{% endblock %}