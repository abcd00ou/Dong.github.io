{% extends "layout.html" %}
{% block title %}Survey{% endblock %}

{% block head %}

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></scriptsrc>></script>

<!-- Vendor CSS Files -->
<link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="static/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="static/vendor/aos/aos.css" rel="stylesheet">
<link href="static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
<link href="static/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

<!-- Main CSS File -->
<!-- <link href="static/css/main.css" rel="stylesheet"> -->
<link href="static/css/index.css" rel="stylesheet">


<script type="text/javascript">
    (function() {
        emailjs.init("_GKGc3e2Afedx7hjm")
    })();
</script>

<style>

    h2 {
        color: #333;
        text-align: center;
        margin-bottom: 20px;
    }

    form {
        background: #fff;
        padding: 20px 0;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        display: flex;
        flex-direction: column;
    }

    label {
        margin-bottom: 5px;
        color: #555;
        font-weight: bold;
    }

    input[type="number"],
    input[type="text"],
    select,
    textarea {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
        width: 100%;
        box-sizing: border-box;
    }

    textarea {
        resize: none;
        height: 100px;
    }

    input[type="submit"] {
        padding: 15px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        width: 100%;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    input[type="submit"]:hover {
        background-color: #45a049;
    }

    ul {
        list-style: none;
        padding-left: 0;
        width: 100%;
    }

    .section {
        margin-bottom: 20px;
    }

    .flex-container {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .flex-container .col-4 {
        flex: 1;
        min-width: 150px;
    }

    .flex-container .col-4 button {
        margin-left: 10px;
        padding: 10px;
        border: none;
        background-color: #36c1ae;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .flex-container .col-4 button:hover {
        background-color: #2a978b;
    }
    .button{
        margin-left: 10px;
        padding: 10px;
        border: none;
        background-color: #36c1ae;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .item_disable {
        pointer-events: none;
        opacity: 0.5;
    }
    .list_depth1 {
        display: none;
        position: fixed;
        bottom: -100%;
    }
    .list_depth1.active {
        display: block;
        bottom: 0;
    }
    .survey_item {
        border-top: 1px solid #dddddd;
    }
    .survey_item:last-child {
        border-bottom: 1px solid #dddddd;
    }
    .survey_btn {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 16px 12px;
        text-align: left;
        border: 0;
        background-color: white;
    }
    .survey_btn_title {
        display: flex;
    }
    .survey_btn_title_name {
        width: 60px;
        margin-right: 12px;
        font-weight: bolder;
    }
    .survey_btn_title_data {

    }

</style>

{% endblock %}

{% block content %}

<body class="index-page" style="margin-top:100px;">
    <header id="header" class="header fixed-top">
        <div class="topbar d-flex align-items-center">
        <div class="container d-flex justify-content-center justify-content-md-between">
            <div class="contact-info d-flex align-items-center">
            <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">contact@example.com</a></i>
            <i class="bi bi-phone d-flex align-items-center ms-4"><span>+1 5589 55488 55</span></i>
            </div>
            <div class="social-links d-none d-md-flex align-items-center">
            <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
            </div>
        </div>
        </div><!-- End Top Bar -->
    
        <div class="branding d-flex align-items-center">
        <div class="container position-relative d-flex align-items-center justify-content-between">
            <a href="{{ url_for('main') }}" class="logo d-flex align-items-center">
                <img src="{{ url_for('static', filename='img/seowoologo.png') }}" alt="">
            </a>
            <nav id="navmenu" class="navmenu">
            <ul>
                <li><a href="#hero">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#Services">Services</a></li>
                <li><a href="{{url_for('survey')}}" class = 'active'>Survey</a></li>
                <li><a href="{{url_for('calendar')}}">Calendar</a></li>
                <li><a href="{{url_for('productivity')}}">Productivity</a></li>
                <li><a href="#team">Team</a></li>
                <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                    <li><a href="#">Dropdown 1</a></li>
                    <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                    <ul>
                        <li><a href="#">Deep Dropdown 1</a></li>
                        <li><a href="#">Deep Dropdown 2</a></li>
                        <li><a href="#">Deep Dropdown 3</a></li>
                        <li><a href="#">Deep Dropdown 4</a></li>
                        <li><a href="#">Deep Dropdown 5</a></li>
                    </ul>
                    </li>
                    <li><a href="#">Dropdown 2</a></li>
                    <li><a href="#">Dropdown 3</a></li>
                    <li><a href="#">Dropdown 4</a></li>
                </ul>
                </li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>
        </div>
        </div>
    </header>
    
    <h2>Survey Form</h2>
   
  

    <label for='survey1'>작업 공수 기재</label>
    <ul id ='survey1'>
        <li class="survey_item">
            <!-- 제조사 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#siteModal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">작업 장소</div>
                    <div class="survey_btn_title_data" id="site"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="siteModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">작업 장소</h1>
                      </div>
                      <ul class="modal-body">
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('site', '당진')">당진</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('site', '마곡')">마곡</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('site', '서울')">서울</li>
                      </ul>
                    </div>
                </div>
            </div>
        </li>
        <li id="cat1Item" class="item_disable survey_item">
            <!-- 모델 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#cat1Modal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">중분류</div>
                    <div class="survey_btn_title_data" id="cat1"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="cat1Modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">중분류</h1>
                      </div>
                      <ul class="modal-body" id="cat1Options">
                        <!-- <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat1', '중분류1')">중분류1</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat1', '중분류2')">중분류2</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat1', '중분류3')">중분류3</li> -->
                      </ul>
                    </div>
                </div>
            </div>
        </li>
        <li id="cat2Item" class="item_disable survey_item">
            <!-- 등급 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#cat2Modal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">층</div>
                    <div class="survey_btn_title_data" id="cat2"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="cat2Modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">층</h1>
                      </div>
                      <ul class="modal-body" id="cat2Options">
                        <!-- <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat2', '층1')">층1</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat2', '층2')">층2</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat2', '층3')">층3</li> -->
                      </ul>
                    </div>
                </div>
            </div>
        </li>
        <li id="cat3Item" class="item_disable survey_item">
            <!-- 등급 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#cat3Modal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">구간</div>
                    <div class="survey_btn_title_data" id="cat3"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="cat3Modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">구간</h1>
                      </div>
                      <ul class="modal-body" id="cat3Options">
                        <!-- <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간1')">구간1</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간2')">구간2</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간3')">구간3</li> -->
                      </ul>
                    </div>
                </div>
            </div>
        </li>
        <li id="cat4Item" class="item_disable survey_item">
            <!-- 등급 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#cat4Modal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">세부구간</div>
                    <div class="survey_btn_title_data" id="cat4"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="cat4Modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">세부구간</h1>
                      </div>
                      <ul class="modal-body" id="cat4Options">
                        <!-- <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간1')">구간1</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간2')">구간2</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간3')">구간3</li> -->
                      </ul>
                    </div>
                </div>
            </div>
        </li>
        <li id="cat5Item" class="item_disable survey_item">
            <!-- 등급 선택 -->
            <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#cat5Modal">
                <div class="survey_btn_title">
                    <div class="survey_btn_title_name">작업내용</div>
                    <div class="survey_btn_title_data" id="cat5"></div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </button>
            
            <div class="modal fade" id="cat5Modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                      <div class="modal-header">
                        <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">작업내용</h1>
                      </div>
                      <ul class="modal-body" id="cat5Options">
                        <!-- <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간1')">구간1</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간2')">구간2</li>
                        <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '구간3')">구간3</li> -->
                      </ul>
                    </div>
                </div>
            </div>
        </li>
 
        <li id="cat6Item" class="item_disable survey_item">
            <!-- 등급 선택 -->
            <button class="survey_btn" onclick="showOptions('cat6')">

                <strong class="tit_category">공수</strong>
                <i class="bi bi-chevron-right"></i>
            </button>
            <input type="number" id="effort" name="effort">
        </li>

    </ul>
    <button id="add-task" class="button" style="float:right">작업추가</button><br><br>
    <label for="task-result">작업내용:</label>
    <textarea id="task-result" disabled="" placeholder="작업을 추가하면 여기서 확인 가능합니다."></textarea>

    <label for='survey2'>인원 및 특이사항</label>
    <ul id ='survey2'>
        <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#workersModal">
            <div class="survey_btn_title">
                <div class="survey_btn_title_name">인원 추가</div>
                <div class="survey_btn_title_data" id="workers"></div>
            </div>
            <i class="bi bi-chevron-right"></i>
        </button>
        
        <div class="modal fade" id="workersModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                  <div class="modal-header">
                    <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">인원 추가</h1>
                  </div>
                  <ul class="modal-body">
                    <label for="numworkers">작업인원:</label>
                    <input type="number" id="numworkers" name="numworkers" min="1">

                    <label for="workers_add1">기본 근무자 추가:</label>
                    <input type="text" id="workers_add1" placeholder="1일 근무자, 없으면 생략">
                    <button id="add1" class="button" style="float:right">작업자 추가</button><br><br><br>
                    <label for="workers-normal">작업자 명:</label>
                    <textarea id="workers-normal" disabled=""></textarea>

                    <label for="workers_add2">추가 근무자 추가:</label>
                    <input type="text" id="workers_add2" placeholder="초과 근무자, 없으면 생략">
                    <button id="add2" class="button" style="float:right">작업자 추가</button><br><br><br>
                    <label for="workers-hard">작업자 명:</label>
                    <textarea id="workers-hard" disabled=""></textarea>

                    <label for="workers_add3">오전 근무자 추가:</label>
                    <input type="text" id="workers_add3" placeholder="0.5일 작업, 없으면 생략">
                    <button id="add3" class="button" style="float:right">작업자 추가</button><br><br><br>
                    <label for="workers-morning">작업자 명:</label>
                    <textarea id="workers-morning" disabled=""></textarea>
                  </ul>
                </div>
            </div>
        </div>
        <button class="survey_btn" data-bs-toggle="modal" data-bs-target="#extraModal">
            <div class="survey_btn_title">
                <div class="survey_btn_title_name">특이사항</div>
                <div class="survey_btn_title_data" id="extra"></div>
            </div>
            <i class="bi bi-chevron-right"></i>
        </button>
        
        <div class="modal fade" id="extraModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                  <div class="modal-header">
                    <i type="button" class="bi bi-chevron-left" data-bs-dismiss="modal" aria-label="Close"></i>
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">특이사항</h1>
                  </div>
                  <ul class="modal-body">
                    <label for="specialnotes">특이사항:</label>
                     <textarea id="specialnotes" name="specialnotes"></textarea>
                     <label for="overtime">연장근무:</label>
                     <textarea id="overtime" name="overtime"></textarea>
                     <button id="add4" class="button" style="float:right">특이사항 추가</button>
                     <label for="additional">특이사항</label>
                    <textarea id="additional" disabled=""></textarea>
                  </ul>
                </div>
            </div>
        </div>

     


    </ul>


  
   <input type="submit" value="Submit" id="submit">

</body>
</html>

<script type="text/javascript">

    var data =null ; 
    $.getJSON('/static/data/test.json', function(item) {
            data =  JSON.parse(item)
            console.log(data)
        }).fail(function() {
            console.error('Error fetching JSON');
        });
    
    

    function populateDropdown(id, options) {
                const select = document.getElementById(id);
                select.innerHTML = '<option value="">Select</option>';
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.text = option;
                    select.appendChild(opt);
                });
	    	}

    function filterData(level) {
            if (!data) {
                console.error('Data is not loaded yet.');
                return;
            }

            const category = document.getElementById('category').value;
            const floor = document.getElementById('floor').value;
            const section = document.getElementById('section').value;

            let filteredData = [];
            if (level === 'category') {
                filteredData = data.filter(item => item['cat1'] === category);
                populateDropdown('floor', [...new Set(filteredData.map(item => item['cat2']))]);
                document.getElementById('section').innerHTML = '<option value="">Select</option>';
                document.getElementById('subsection').innerHTML = '<option value="">Select</option>';
                document.getElementById('task').innerHTML = '<option value="">Select</option>';
            } else if (level === 'floor') {
                filteredData = data.filter(item => item['cat1'] === category && item['cat2'] === floor);
                populateDropdown('section', [...new Set(filteredData.map(item => item['cat3']))]);
                document.getElementById('subsection').innerHTML = '<option value="">Select</option>';
                document.getElementById('task').innerHTML = '<option value="">Select</option>';
            } else if (level === 'section') {
                filteredData = data.filter(item => item['cat1'] === category && item['cat2'] === floor && item['cat3'] === section);
                populateDropdown('subsection', [...new Set(filteredData.map(item => item['cat4']))]);
                populateDropdown('task', [...new Set(filteredData.map(item => item['작업 내용']))]);
            }
        };

    var site = null;
    var cat1 = null;
    var cat2 = null;
    var cat3 = null;
    var cat4 = null;
    var cat5 = null;
    var cat6 = null;

    // function showOptions(category) {
    //     console.log(document.getElementById(category + 'Options').classList)
    //     console.log(document.getElementById(category + 'Options').classList.length)
        
    //     if(document.getElementById(category + 'Options').classList.contains("active")){
    //         console.log("active있음")
    //         document.querySelectorAll('.list_depth1').forEach(el => el.classList.remove('active'));
    //         document.getElementById(category + 'Options').classList.remove('active');
        
    //     }else{
    //         console.log("active없음")
    //         document.querySelectorAll('.list_depth1').forEach(el => el.classList.remove('active'));
    //         document.getElementById(category + 'Options').classList.add('active');
    //     }
    //     console.log(document.getElementById(category + 'Options').classList)
    //     console.log(document.getElementById(category + 'Options').classList.length)
    //     console.log(category)
    //     console.log('aa')
    // }
    

    function selectOption(category, value) {
        if (category === 'site') {
            var site = value;
            document.getElementById('cat1Item').classList.remove('item_disable');
            const modelOptions = document.getElementById('cat1Options');
            console.log(data)
            const uniqueValues = [...new Set(data.filter(item => item['작업장명'] === value).map(item => item['중분류']))];
           
            modelOptions.innerHTML = uniqueValues.map(model => 
                ` <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat1','${model}')"> ${model}</li>`
            ).join('');
            document.getElementById('site').innerHTML = value;
        } else if (category === 'cat1') {
     
            var cat1 = value;
            var site = document.getElementById('site').textContent
            console.log(site)
            console.log(cat1)
            document.getElementById('cat2Item').classList.remove('item_disable');
            const modelOptions = document.getElementById('cat2Options');
            console.log(data)
            const uniqueValues = [...new Set(data.filter(item => item['작업장명'] === site&&item['중분류'] === value).map(item => item['층']))];
            console.log(uniqueValues)
            modelOptions.innerHTML = uniqueValues.map(model => 
                ` <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat2','${model}')"> ${model}</li>`
            ).join('');
            console.log(document.getElementById(category + 'Options'))
            document.getElementById(category + 'Options').classList.remove('active');
            document.getElementById('cat1').innerHTML = value;
            console.log("Aa")
        } else if(category==="cat2"){
            var cat2 = value;
            var cat1 = document.getElementById('cat1').textContent;
            var site = document.getElementById('site').textContent
            document.getElementById('cat3Item').classList.remove('item_disable');
            const modelOptions = document.getElementById('cat3Options');
            console.log(data)
            const uniqueValues = [...new Set(data.filter(item => item['작업장명'] === site&&item['중분류'] === cat1&&item['층'] === value).map(item => item['구간']))];
            modelOptions.innerHTML = uniqueValues.map(model => 
               ` <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat3', '${model}')"> ${model}</li>`
            ).join('');
            document.getElementById('cat2').innerHTML = value;
       

        }else if(category==="cat3"){
            var cat3 = value;
            var cat2 = document.getElementById('cat2').textContent;
            var cat1 = document.getElementById('cat1').textContent;
            var site = document.getElementById('site').textContent
            document.getElementById('cat4Item').classList.remove('item_disable');
            const modelOptions = document.getElementById('cat4Options');
            const uniqueValues = [...new Set(data.filter(item => item['작업장명'] === site&&item['중분류'] === cat1&&item['층'] === cat2&&item['구간'] === value).map(item => item['세부구간']))];
            console.log(uniqueValues.length)            
            modelOptions.innerHTML = uniqueValues.map(model => 
                ` <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat4', '${model}')"> ${model}</li>`
            ).join('');
       
            document.getElementById('cat3').innerHTML = value;
        }else if(category==="cat4"){
            var cat4= value;
            var cat3 = document.getElementById('cat3').textContent;
            var cat2 = document.getElementById('cat2').textContent;
            var cat1 = document.getElementById('cat1').textContent;
            var site = document.getElementById('site').textContent
            document.getElementById('cat5Item').classList.remove('item_disable');
            const modelOptions = document.getElementById('cat5Options');
            const uniqueValues = [...new Set(data.filter(item => item['작업장명'] === site&&item['중분류'] === cat1&&item['층'] === cat2&&item['구간'] === cat3&&item['세부구간'] === value).map(item => item['작업 내용']))];
            modelOptions.innerHTML = uniqueValues.map(model => 
                ` <li type="button" data-bs-dismiss="modal" aria-label="Close" onclick="selectOption('cat5', '${model}')"> ${model}</li>`
            ).join('');
            document.getElementById('cat4').innerHTML = value;
      

        }else if(category==="cat5"){
            var cat5= value;
            document.getElementById('cat6Item').classList.remove('item_disable');
            

        }

        // Hide the current options after selection
        
    }

    

     

    window.onload = function(){
        
        $('#siteOptions li').on('click', function() {
            $('#siteOptions li').removeClass('selected');
            $(this).addClass('selected');
            console.log(this)
        });

        $('#cat1Options li').on('click', function() {
            $('#cat1Options li').removeClass('selected');
            $(this).addClass('selected');
        });

        $('#cat2Options li').on('click', function() {
            $('#cat2Options li').removeClass('selected');
            $(this).addClass('selected');
        });

        $('#cat3Options li').on('click', function() {
            $('#cat3Options li').removeClass('selected');
            $(this).addClass('selected');
        });

        $('#cat4Options li').on('click', function() {
            $('#cat4Options li').removeClass('selected');
            $(this).addClass('selected');
        });

        $('#cat5Options li').on('click', function() {
            $('#cat5Options li').removeClass('selected');
            $(this).addClass('selected');
        });
       
        $('#add-task').on('click', function() {
			event.preventDefault();
            var cat5 = document.getElementById('cat5').textContent;
            var cat4 = document.getElementById('cat4').textContent;
            var cat3 = document.getElementById('cat3').textContent;
            var cat2 = document.getElementById('cat2').textContent;
            var cat1 = document.getElementById('cat1').textContent;
            var site = document.getElementById('site').textContent
             const cat6 = document.getElementById('effort').value; 
             console.log(site,cat1,cat2,cat3,cat4,cat5,cat6)

		   	
		     var task_result = document.getElementById('task-result');

            task_result.textContent += site+"_"+cat1+"_"+cat2+"_"+cat3+"_"+cat4+"_"+cat5+"_"+cat6+"\n"; 
  
		 });
    
  		 document.getElementById('add1').addEventListener('click', function(event) {
			event.preventDefault();
		     var newbie = document.getElementById('workers_add1').value; 
		   	 var work_list = document.getElementById('workers-normal');
		   	
		     work_list.textContent += newbie+","; 
		   	document.getElementById('workers_add1').value = "";
		   
		 });
  
		document.getElementById('add2').addEventListener('click', function(event) {
					event.preventDefault();
				   var newbie = document.getElementById('workers_add2').value; 
				   var work_list = document.getElementById('workers-hard');

				   work_list.textContent += newbie+","; 
				  document.getElementById('workers_add2').value = "";

			   });

		document.getElementById('add3').addEventListener('click', function(event) {
				  event.preventDefault();
				   var newbie = document.getElementById('workers_add3').value; 
				   var work_list = document.getElementById('workers-morning');

				   work_list.textContent += newbie+","; 
				  document.getElementById('workers_add3').value = "";

			   });

        document.getElementById('add4').addEventListener('click', function(event) {
				  event.preventDefault();
				   var specialnotes = document.getElementById('specialnotes').value; 
				   var overtime = document.getElementById('overtime').value;
                   var work_list = document.getElementById('additional');
				   work_list.textContent += "특이사항: "+specialnotes+"\n"+"연장근무: "+overtime; 
				   document.getElementById('specialnotes').value = "";
                   document.getElementById('overtime').value = "";


			   });

        // document.getElementById('add-task').addEventListener('click', function(event) {
		// 		  event.preventDefault();
		// 		   var category = document.getElementById('category').value; 
        //            var floor = document.getElementById('floor').value; 
        //            var section = document.getElementById('section').value; 
        //            var subsection = document.getElementById('subsection').value; 
        //            var task = document.getElementById('task').value; 
        //            var effort = document.getElementById('effort').value; 
                   
		// 		   var task_result = document.getElementById('task-result');

		// 		   task_result.textContent += category+"_"+floor+"_"+section+"_"+subsection+"_"+task+"_"+effort+"\n"; 
        //            document.getElementById('category').value = "";
        //            document.getElementById('floor').value = "";
        //            document.getElementById('section').value = "";
        //            document.getElementById('subsection').value = "";
        //            document.getElementById('task').value = "";
        //            document.getElementById('effort').value = "";
                   

		// 	   });

        
   


       
        


    // 1. 페이지 로드 시 인증을 위한 함수 호출
   

       document.getElementById('submit').addEventListener('click', function(event) {
           createEvent()
           var task_result = document.getElementById('task-result');
           const formData = {
					  numworkers: document.getElementById('numworkers').value,
					  workersnormal: document.getElementById('workers-normal').value,
					  workershard: document.getElementById('workers-hard').value,
					  workersmorning: document.getElementById('workers-morning').value,
					  taskresult : document.getElementById("task-result").value,
                      additional: document.getElementById('additional').value,
					 
				  };
        var eventId = 1 + Math.floor(Math.random() * 1000);
        function getCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        var eventData = {
            _id: eventId,
            title: document.getElementById('site').textContent,
            start: getCurrentDateTime(),
            end: getCurrentDateTime(),
            description: JSON.stringify(formData),
            type: '카테고리1',
            username: '나연',
            backgroundColor: '#D25565',
            textColor: '#ffffff',
            allDay: false
        };


        $("#calendar").fullCalendar('renderEvent', eventData, true);
        eventModal.find('input, textarea').val('');
        editAllDay.prop('checked', false);
        eventModal.modal('hide');
        console.log(eventData)
        //새로운 일정 저장
        $.ajax({
            type: "get",
            url: "/static/data/calendar.json",
            data: {
                //.....
            },
            success: function (response) {
                console.log(response)
                var data = response; 

                data.push(eventData);
                console.log(data)
                //DB연동시 중복이벤트 방지를 위한
                //$('#calendar').fullCalendar('removeEvents');
                //$('#calendar').fullCalendar('refetchEvents');
                json_data = JSON.stringify(data)
                console.log(json_data)
                $.ajax({
                    url: '/calendar_save', // 데이터를 저장할 서버의 URL
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({data:json_data}),
                    success: function(response) {
                        alert('Data saved successfully:', response);
                    },
                    error: function(error) {
                        alert('Error saving data:', error);
                    }
                });
            }
        });


        })

		//  document.getElementById('survey-form').addEventListener('submit', function(event) {
                   
		// 			 // Submit 시점에 required 속성 추가
		// 		  document.getElementById('numworkers').required = true;
		// 		  document.getElementById('specialnotes').required = true;
		// 		  document.getElementById('overtime').required = true;

		// 		  if (!document.getElementById('survey-form').checkValidity()) {
		// 			  // required validation failed
		// 			  event.preventDefault();
		// 			  alert('Please fill all required fields.');
		// 			  return;
		// 		  }


		// 		  event.preventDefault();

		// 		  const formData = {
		// 			  numworkers: document.getElementById('numworkers').value,
		// 			  workersnormal: document.getElementById('workers-normal').value,
		// 			  workershard: document.getElementById('workers-hard').value,
		// 			  workersmorning: document.getElementById('workers-morning').value,
		// 			  taskresult : document.getElementById("task-result").value,
        //               specialnotes: document.getElementById('specialnotes').value,
		// 			  overtime: document.getElementById('overtime').value
		// 		  };

		// 		  emailjs.send('service_odcgc2y', 'template_7pojdeh', formData)
		// 			  .then(function(response) {
		// 				  alert('Email sent successfully!');
		// 			  }, function(error) {
		// 				  alert('Failed to send email. Error: ' + JSON.stringify(error));
		// 			  });
		// 	  });

              async function getAccessToken() {

                
                // URL에서 code와 state 파라미터를 추출
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const state = urlParams.get('state');

                const response = await fetch('/callback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    code: code,
                    grant_type: 'authorization_code',
                    client_id: '8zESjIVD54_8K5PA_dIu',
                    client_secret: 'wyWAH1uLEY'
                })
                });
                
                // // 토큰 정보 사용 예제
                // const accessToken = tokenInfo.access_token;
                alert('Access Token: ' + accessToken);
                const tokenInfo = await response.json();
                const accessToken = tokenInfo.access_token;
                console.log("fetch전")
                fetchFiles(accessToken);
                }

    function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
        }


        async function createEvent() {
            const formData = {
					  numworkers: document.getElementById('numworkers').value,
					  workersnormal: document.getElementById('workers-normal').value,
					  workershard: document.getElementById('workers-hard').value,
					  workersmorning: document.getElementById('workers-morning').value,
					  taskresult : document.getElementById("task-result").value,
                      specialnotes: document.getElementById('specialnotes').value,
					  overtime: document.getElementById('overtime').value
				  };

            const start = new Date();
            start2 = formatDateTime(start)
            console.log(start)

            // const token = await getAccessToken();
     

            const event = {
                summary: "Testmessage",
                description: JSON.stringify(formData),
               
                recurrence:[],
                recurringEventId:"TZID=Asia/Seoul:2025-04-05"
            };
            console.log("?????")
            const response = await fetch('/create_event', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(event)
            });

            const result = await response.json();
            document.getElementById('result').innerText = result.message;
        };

        // 3. 파일 조회 함수
        async function fetchFiles(accessToken) {
            const response = await fetch('https://www.worksapis.com/v1.0/sharedrives', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const files = await response.json();
            console.log(files);
            // 파일 목록을 화면에 표시하는 함수 호출 (추가 작업 필요)
            displayFiles(files);
        }

        // 4. 파일 목록을 화면에 표시하는 함수 (예제)
        function displayFiles(files) {
            const fileList = document.createElement('ul');
            files.forEach(file => {
                const listItem = document.createElement('li');
                listItem.textContent = file.name; // 예시로 파일 이름을 표시
                fileList.appendChild(listItem);
            });
            document.body.appendChild(fileList);
        }


            };

      
        
  	
</script>
<script src="static/js/jquery.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/moment.min.js"></script>
<script src="static/js/fullcalendar.min.js"></script>
<script src="static/js/ko.js"></script>
<script src="static/js/select2.min.js"></script>
<script src="static/js/bootstrap-datetimepicker.min.js"></script>

<script src="static/js/calendar.js"></script>
<script src="static/js/addEvent.js"></script>
<script src="static/js/editEvent.js"></script>
<script src="static/js/etcSetting.js"></script>


{% endblock %}